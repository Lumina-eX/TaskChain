name: ğŸ·ï¸ Issue Triage

on:
  issues:
    types:
      - opened

permissions:
  issues: write

jobs:
  triage:
    name: Auto-triage New Issues
    runs-on: ubuntu-latest

    steps:
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Step 1 â€“ Apply correct label based on issue template type
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Detect template and apply labels
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const title = issue.title || '';
            const body  = issue.body  || '';

            const labelsToAdd = [];

            if (title.startsWith('[Bug]'))   labelsToAdd.push('bug');
            if (title.startsWith('[Feature]')) labelsToAdd.push('enhancement');
            if (title.startsWith('[Docs]'))  labelsToAdd.push('documentation');

            // Always add needs-triage on first open
            labelsToAdd.push('needs-triage');

            if (labelsToAdd.length > 0) {
              await github.rest.issues.addLabels({
                owner:       context.repo.owner,
                repo:        context.repo.repo,
                issue_number: issue.number,
                labels:      [...new Set(labelsToAdd)],
              });
              core.info(`Applied labels: ${labelsToAdd.join(', ')}`);
            }

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Step 2 â€“ Assign the default maintainer
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Assign maintainer
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.addAssignees({
              owner:        context.repo.owner,
              repo:         context.repo.repo,
              issue_number: context.payload.issue.number,
              assignees:    ['Olowodarey'],
            });
            core.info('Assigned issue to @Olowodarey');

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Step 3 â€“ Post a welcome & notification comment
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: Post welcome comment
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.payload.issue;
            const author = issue.user.login;
            const title  = issue.title || '';

            let templateNote = 'an issue';
            if (title.startsWith('[Bug]'))     templateNote = 'a **Bug Report**';
            if (title.startsWith('[Feature]')) templateNote = 'a **Feature Request**';
            if (title.startsWith('[Docs]'))    templateNote = 'a **Documentation Update**';

            const body = [
              `ğŸ‘‹ Thank you for opening ${templateNote}, @${author}!`,
              '',
              'Your issue has been received and is now in the triage queue.',
              '',
              '| Detail | Value |',
              '|--------|-------|',
              `| ğŸ“Œ Issue | #${issue.number} |`,
              `| ğŸ·ï¸ Labels | \`needs-triage\` applied |`,
              `| ğŸ‘¤ Assigned to | @Olowodarey |`,
              '',
              '> **@Olowodarey** â€” a new issue has been opened and is awaiting your review.',
              '',
              '---',
              '_Please keep the conversation respectful and on-topic._',
              '_Our maintainers will respond as soon as possible. ğŸ™_',
            ].join('\n');

            await github.rest.issues.createComment({
              owner:        context.repo.owner,
              repo:         context.repo.repo,
              issue_number: issue.number,
              body,
            });
            core.info('Welcome comment posted successfully.');
